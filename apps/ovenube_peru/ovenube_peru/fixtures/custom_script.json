[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Material Request",
  "modified": "2019-03-28 13:14:33.495335",
  "name": "Material Request-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.cscript.custom_refresh = function(doc) {\n    switch(this.frm.doc.company) {\n        case \"VIVENTIAL\":\n            cur_frm.doc.naming_series = \"MREQ-\";\n            break;\n\tcase \"THE ENGLISH WALKER S.A.C.\":\n            cur_frm.doc.naming_series = \"MREQTEW-\";\n            break;\n\tcase \"BLAIBERG CARRASCO\":\n            cur_frm.doc.naming_series = \"MREQBLG-\";\n            break;\n\tcase \"U-EDUCATION E.I.R.L\":\n            cur_frm.doc.naming_series = \"MREQUED-\";\n            break;\n\tcase \"U-EDUCATION IQUITOS\":\n            cur_frm.doc.naming_series = \"MREQUEDIQT-\";\n            break;\n        default:\n            cur_frm.doc.naming_series = \"\";\n            break;\n         }\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Asset Repair",
  "modified": "2019-02-27 19:57:12.208063",
  "name": "Asset Repair-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch('codigo','comportamiento','comportamiento');\ncur_frm.add_fetch('codigo','tipo_fluido','tipo_fluido');\n\ncur_frm.add_fetch('producto','item_name','nombre');\ncur_frm.add_fetch('producto','brand','marca');"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Expense Claim",
  "modified": "2019-03-08 11:45:50.830115",
  "name": "Expense Claim-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch('tdx_c_codigoproveedor', 'supplier_name', 'tdx_c_proveedor');"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Timesheet",
  "modified": "2019-12-24 16:59:53.080707",
  "name": "Timesheet-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch('codigo', 'comportamiento', 'comportamiento');\ncur_frm.add_fetch('codigo', 'tipo_fluido', 'tipo_fluido');\ncur_frm.add_fetch('empleado', 'employee_name', 'nombre_empleado');\ncur_frm.add_fetch('empleado', 'designation', 'puesto');\ncur_frm.add_fetch('task', 'depth', 'tdx_c_prfinitur');\nfunction get_productos(frm, cdt, cdn) {\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"erpnext.projects.doctype.catalogo_proyecto.catalogo_proyecto.get_catalogo_productos\",\n\t\targs: {\n\t\t\tproject: frm.doc.project\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tcur_frm.set_query(\"item_code\", \"items\", function(){\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\"filters\": [\n\t\t\t\t\t\t\t[\"Item\", \"name\", \"in\", r.message]]\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t})\n};\nfunction get_actividades(frm, cdt, cdn) {\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"erpnext.projects.doctype.catalogo_proyecto.catalogo_proyecto.get_catalogo_actividades\",\n\t\targs: {\n\t\t\tproject: frm.doc.project\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tcur_frm.set_query(\"activity_type\", \"time_logs\", function(){\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\"filters\": [\n\t\t\t\t\t\t\t[\"Activity Type\", \"name\", \"in\", r.message]]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcur_frm.set_query(\"item\", \"perforacion\", function(){\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\"filters\": [\n\t\t\t\t\t\t\t[\"Item\", \"name\", \"in\", r.message]]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t})\n};\nfunction get_perforado_details(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"erpnext.projects.doctype.valoracion_perforado.valoracion_perforado.get_rango_info\",\n\t\targs: {\n\t\t\tproject: frm.doc.project,\n\t\t\trango: d['rango']\n\t\t},\n\t\tcallback: function(r){\n\t\t\td['medida'] = r.message['medida'];\n\t\t\td['precio'] = r.message['precio'];\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t})\n};\nfunction get_actividades_details(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"erpnext.projects.doctype.catalogo_proyecto.catalogo_proyecto.get_catalogo_actividades_info\",\n\t\targs: {\n\t\t\tproject: frm.doc.project,\n\t\t\tactividad: d['activity_type']\n\t\t},\n\t\tcallback: function(r){\n\t\t\td['costing_rate'] = r.message['precio'];\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t})\n};\nfunction get_productos_details(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"erpnext.projects.doctype.catalogo_proyecto.catalogo_proyecto.get_producto_info\",\n\t\targs: {\n\t\t\tproject: frm.doc.project,\n\t\t\tproducto: d['item_code']\n\t\t},\n\t\tcallback: function(r){\n\t\t\td['item_name'] = r.message['nombre_proyecto'];\n\t\t\td['item_group'] = r.message['grupo'];\n\t\t\td['precio'] = r.message['precio'];\n\t\t\td['stock_uom'] = r.message['stock_uom'];\n\t\t\td['brand'] = r.message['brand'];\n\t\t\td['serial_no'] = r.message['serial_no'];\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t})\n};\nfunction get_metros_perforado(frm, cdt, cdn) {\n\tif (frm.doc.tdx_c_prfinitur !== undefined && frm.doc.tdx_c_prffintur){\n\t\tif (frm.doc.tdx_c_prfinitur < frm.doc.tdx_c_prffintur){\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tdx_c_prfmt\", frm.doc.tdx_c_prffintur - frm.doc.tdx_c_prfinitur)\n\t\t}\n\t}\n};\nfunction get_metros_perforado_detalle(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n\tif (d['metro_desde'] < d['metro_hasta']){\n\t\td['perforado'] = d['metro_hasta'] - d['metro_desde'];\n\t\tfrm.refresh_fields();\n\t}\n}\nfrappe.ui.form.on(\"Timesheet\", {\n\ttdx_c_prfinitur: function(frm, cdt, cdn) {\n\t\tget_metros_perforado(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on(\"Timesheet\", {\n\ttdx_c_prffintur: function(frm, cdt, cdn) {\n\t\tget_metros_perforado(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on(\"Detalle Perforado\", {\n\t\"metro_desde\": function(frm, cdt, cdn) {\n\t\tget_metros_perforado_detalle(frm, cdt, cdn);\n\t},\n\t\"metro_hasta\": function(frm, cdt, cdn) {\n\t\tget_metros_perforado_detalle(frm, cdt, cdn);\n\t},\n\t\"recuperacion\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif (d['recuperacion'] >= 0 && d['perforado'] >= 0){\n\t\t\td['porcentaje_recuperacion'] = d['recuperacion'] / d['perforado'] * 100;\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Timesheet\", {\n\tonload: function(frm, cdt, cdn) {\n\t\tfrm.toggle_display(\"billing_details_amounts\", true);\n\t\tif (frm.doc.total_productos_proyecto === undefined){\n\t\t\tfrappe.model.set_value(cdt, cdn, \"total_productos_proyecto\", 0);\n\t\t\tcur_frm.set_df_property(\"total_productos_proyecto\", \"read_only\", true);\n\t\t}\n\t\tif (frm.doc.total_perforado_valorizado === undefined){\n\t\t\tfrappe.model.set_value(cdt, cdn, \"total_perforado_valorizado\", 0);\n\t\t\tcur_frm.set_df_property(\"total_perforado_valorizado\", \"read_only\", true);\n\t\t}\n\t\tif (frm.doc.tiempo_finalizacion === undefined){\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tiempo_finalizacion\", 0);\n\t\t}\n\t},\n\tproject: function(frm, cdt, cdn) {\n\t\tif (frm.doc.project){\n\t\t\tget_perforado(frm, cdt, cdn);\n\t\t\tget_productos(frm, cdt, cdn);\n\t\t\tget_actividades(frm, cdt, cdn);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Detalle Perforado Valorizado\", {\n\t\"rango\": function(frm, cdt, cdn) {\n\t\tif (locals[cdt][cdn]['rango']){\n\t\t\tget_perforado_details(frm, cdt, cdn);\n\t\t}\t\t\n\t},\n\t\"metrado\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif (d['metrado'] && d['rango']){\n\t\t\td['total'] = d['precio'] * d['metrado'];\n\t\t\tfrm.refresh_fields();\n\t\t\tif (d['total']){\n\t\t\t\tfrappe.model.set_value(d['parenttype'], d['parent'], \"total_perforado_valorizado\", (locals['Timesheet'][d['parent']]['total_perforado_valorizado'] + d['total']))\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (d['total']){\n\t\t\t\tfrappe.model.set_value(d['parenttype'], d['parent'], \"total_perforado_valorizado\", (locals['Timesheet'][d['parent']]['total_perforado_valorizado'] - d['total']))\n\t\t\t}\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Detalle Productos\", {\n\t\"item_code\": function(frm, cdt, cdn) {\n\t\tif (locals[cdt][cdn]['item_code']){\n\t\t\tget_productos_details(frm, cdt, cdn);\n\t\t}\t\t\n\t},\n\t\"bill\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif (d['bill']){\n\t\t\td['qty_bill'] = d['qty'];\n\t\t\td['precio_total'] = d['precio'] * d['qty'];\n\t\t\tfrm.refresh_fields();\n\t\t\tif (d['precio_total']){\n\t\t\t\tfrappe.model.set_value(d['parenttype'], d['parent'], \"total_productos_proyecto\", (locals['Timesheet'][d['parent']]['total_productos_proyecto'] + d['precio_total']));\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (d['precio_total']){\n\t\t\t\tfrappe.model.set_value(d['parenttype'], d['parent'], \"total_productos_proyecto\", (locals['Timesheet'][d['parent']]['total_productos_proyecto'] - d['precio_total']));\n\t\t\t}\n\t\t}\n\t},\n\t\"qty\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\td['qty_bill'] = d['qty'];\n\t\tfrm.refresh_fields();\n\t}\n});\nfrappe.ui.form.on(\"Timesheet Detail\", {\n\t\"activity_type\": function(frm, cdt, cdn) {\n\t\tif (locals[cdt][cdn]['activity_type']){\n\t\t\tget_actividades_details(frm, cdt, cdn);\n\t\t}\t\t\n\t}\n});\nfrappe.ui.form.on(\"Timesheet Detail\", {\n\t\"activity_type\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tvar tiempo_finalizacion = locals['Timesheet'][d['parent']]['tiempo_finalizacion'];\n\t\tif (tiempo_finalizacion != 0) {\n\t\t\td['from_time'] = tiempo_finalizacion;\n\t\t\tfrm.refresh_fields();\n\t\t}\n\t},\n\t\"to_time\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tvar tiempo_finalizacion = locals['Timesheet'][d['parent']]['tiempo_finalizacion'];\n\t\tlocals['Timesheet'][d['parent']]['tiempo_finalizacion'] = d['to_time'];\n\t\tfrm.refresh_fields();\n\t},\n\t\"hours\": function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\td['billing_hours'] = d['hours'];\n\t\tfrm.refresh_fields();\n\t}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Asset Maintenance Log",
  "modified": "2018-12-21 05:44:20.151144",
  "name": "Asset Maintenance Log-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch('tdx_c_codigo','tdx_c_comportamiento','tdx_c_comportamiento');\ncur_frm.add_fetch('tdx_c_codigo','tdx_c_tipofluido','tdx_c_tipofluido');\n\ncur_frm.add_fetch('tdx_c_codigorp','item_name','tdx_c_nombre');\ncur_frm.add_fetch('tdx_c_codigorp','brand','tdx_c_marca');"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Stock Entry",
  "modified": "2021-05-23 14:59:00.709830",
  "name": "Stock Entry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "cur_frm.add_fetch(\"tdx_c_solicitadopor\", \"employee_name\", \"tdx_c_solicitadonombre\");\ncur_frm.add_fetch(\"tdx_c_autorizadopor\", \"employee_name\", \"tdx_c_autorizadonombre\");\ncur_frm.add_fetch(\"tdx_c_ut_transportista\", \"tax_id\", \"tdx_c_ut_transportistan\");\ncur_frm.add_fetch(\"tdx_c_ut_placa\", \"make\", \"tdx_c_ut_marca\");"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Invoice",
  "modified": "2021-09-29 16:11:26.621092",
  "name": "Sales Invoice-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})\n\n//PERSONALIZACION\n//Detraccion - Percepcion - Retencion\n\tcur_frm.add_fetch('tdx_c_figv_codigo','tdx_c_figv_nombre','tdx_c_figv_nombre');\n\tcur_frm.add_fetch('tdx_c_figv_codigo','tdx_c_figv_ddetraccion','tdx_c_figv_ddetraccion');\n\tcur_frm.add_fetch('tdx_c_figv_codigo','tdx_c_figv_dpercepcion','tdx_c_figv_dpercepcion');\n\tcur_frm.add_fetch('tdx_c_figv_codigo','tdx_c_figv_porcentaje','tdx_c_figv_porcentaje');\n\n\nfrappe.ui.form.on('Fiscalizacion del IGV Venta', 'tdx_c_figv_codigo', function(frm, cdt, cdn){\n    set_total_por(frm);\n});\n//calcular porcentaje\nvar set_total_por = function(frm){\n    var spot = \"\";\n    var por_ret = 0.0;\n    var total_ret = 0.0;\n    var total_det = 0.0;\n    var total_per = 0.0;\n\n    $.each(frm.doc.tdx_c_spot, function(i, row){\n        por_ret = flt(row.tdx_c_figv_porcentaje/100)*frm.doc.grand_total;\n        if (row.tdx_c_figv_nombre == \"Retencion\"){\n            spot = \"Retencion\"\n            total_ret += flt(por_ret);\n        }\n        if (row.tdx_c_figv_nombre == \"Detraccion\"){\n            spot = \"Detraccion\"\n            total_det += flt(por_ret);\n        }\n        if (row.tdx_c_figv_nombre == \"Percepcion\"){\n            spot = \"Percepcion\"\n            total_per += flt(por_ret);\n        }\n        row.tdx_c_figv_monto = por_ret;\n    });\n    refresh_field(\"tdx_c_spot\");\n    switch(spot){\n        case \"Retencion\":\n            //frm.doc.total_retencion = Math.floor(parseFloat(frm.doc.grand_total-total_ret)/10)*10;\n            frm.doc.total_retencion = frm.doc.grand_total-total_ret;\n            frm.doc.total_detraccion = \"\";\n            frm.doc.total_percepcion = \"\";\n            \n            break;\n        case \"Detraccion\":\n            frm.doc.total_retencion = \"\";\n            frm.doc.total_detraccion = frm.doc.grand_total-total_det;\n            frm.doc.total_percepcion = \"\";\n            \n            break;\n        case \"Percepcion\":\n            frm.doc.total_retencion = \"\";\n            frm.doc.total_detraccion = \"\";\n            frm.doc.total_percepcion = frm.doc.grand_total-total_per;\n            \n            break;\n        default:\n            break;\n    }\n    refresh_field(\"total_retencion\");\n    refresh_field(\"total_detraccion\");\n    refresh_field(\"total_percepcion\");\n    \n    //frm.doc.total_general = Math.floor(parseFloat(frm.doc.total_retencion + frm.doc.total_detraccion + frm.doc.total_percepcion)/10)*10;\n    //frm.doc.total_general = Math.floor(frm.doc.total_retencion + frm.doc.total_detraccion + frm.doc.total_percepcion);\n    frm.doc.total_general = frm.doc.total_retencion + frm.doc.total_detraccion + frm.doc.total_percepcion;\n    refresh_field(\"total_general\");\n    \n};\n//FIN PERSONALIZACION "
 }
]